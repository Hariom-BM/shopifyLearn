<div class="section-sm">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-xl-10 offset-xl-1">
        <h1 class="cart-title mb-6">{{ 'cart.general.title' | t }}</h1>
        
          <ig-shipping-progress-container></ig-shipping-progress-container>
        {% if cart.item_count > 0 %}
        <form action="/cart" method="post" novalidate>

          <div class="table-responsive corso-desktop">
            <table id="cartList" class="cart-items table">
              <thead>
                <tr>
                  <th class="d-none d-sm-table-cell pl-0 image">&nbsp;</th>
                  <th class="pl-0">{{ 'cart.label.product' | t }}</th>
                  <th width="100" >{{ 'cart.label.price' | t }}</th>
                  <th width="220" class="text-center">{{ 'cart.label.quantity' | t }}</th>
                  <th width="100" class="text-right pr-0">{{ 'cart.label.total' | t }}</th>
                </tr>
              </thead>
              <tbody>
                {% assign intelligems_total = 0 %}
                {% for item in cart.items %}
                    {% case item.properties._igLineItemDiscount %}
                      {% when "0" or nil or blank %}
                        {% assign intelligems_discount = 0 %}
                      {% else %}
                        {% assign intelligems_discount = item.properties._igLineItemDiscount | plus: 0 %}
                        {% assign intelligems_total = intelligems_total | plus: item.properties._igLineItemDiscount | times: item.quantity %}
                    {% endcase %} 
                <tr data-id="{{ item.key }}">

                  <!-- IMAGE -->
                  <td class="d-none d-sm-table-cell pl-0">
                    {% if item.image != blank %}
                    <a href="{{ item.url | within: collections.all }}">
                      <img class="img-fluid" src="{{ item | img_url: '300x300' }}" />
                    </a>
                    {% endif %}
                  </td>

                  <!-- TITLE -->
                  <td class="pl-0">
                    <div class="mt-6 d-none d-lg-block"></div>
                    <div class="mt-3 d-none d-md-block d-md-none"></div>

                    {% if item.image != blank %}
                    <a href="{{ item.url | within: collections.all }}">
                      <img class="img-fluid mb-2 d-sm-none" style="background:#fff;" src="{{ item | img_url: '50x' }}" />
                    </a>
                    {% endif %}                                                

                    <a class="dark-link" href="{{ item.url }}">{{ item.product.title }}</a>

                    <div>
                      {% unless item.product.has_only_default_variant %}
                      <span class="variant-title">{{ item.variant.title }}</span>
                      {% endunless %}
                      {% if item.variant.inventory_management == 'shipwire-app' %}
                      	{% if item.variant.inventory_quantity < 5 %}
                      		<span class="stock-alert">Only {{item.variant.inventory_quantity}} left</span>
                      	{% endif %}
                      {% endif %}
                    </div>

                    {%- assign property_size = item.properties | size -%}
                    {% if property_size > 0 %}
                    {% for p in item.properties %}
                    {% assign first_character_in_key = p.first | truncate: 1, '' %}
                    {% unless p.last == blank or first_character_in_key == '_' %}
                    {{ p.first }}:
                    {% if p.last contains '/uploads/' %}
                    <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
                    {% else %}
                    {{ p.last }}
                    {% endif %}
                    {% endunless %}
                    {% endfor %}
                    {% endif %}

                    <a class="btn btn-sm pl-0 pr-0 mt-2 cart__remove" data-vid={{ item.variant_id }} data-ucd="0" href="/cart/change?line={{ forloop.index }}&amp;quantity=0">{{ 'cart.general.remove' | t }}</a>
                  </td>

                  <!-- PRICE -->
                  <td>
                    <div class="mt-6 d-none d-lg-block"></div>
                    <div class="mt-3 d-none d-md-block d-md-none"></div>

                    {% if item.original_line_price != item.line_price and intelligems_discount == 0 %}
                    <span class="visually-hidden">{{ 'cart.label.discounted_price' | t }}</span>
                    {{ item.price | money }}
                    <span class="visually-hidden">{{ 'cart.label.original_price' | t }}</span>
                    <s>{{ item.original_price | money }}</s>
                    {% else %}
                    {{ item.price | money }}
                    {% endif %}
                  </td>

                  <!-- QTY -->
                  <td class="text-center">
                    <div class="mt-6 d-none d-lg-block"></div>
                    <div class="mt-3 d-none d-md-block d-md-none"></div>

                    <div class="inum inum-sm">
                      <input class="form-control form-control-sm mb-0 text-center" type="number" name="updates[]" id="updates_{{ item.key }}" value="{{ item.quantity }}" data-default-value="{{ item.quantity }}" min="0" aria-label="{{ 'cart.general.item_quantity' | t }}">
                      <div class="inum-btn inum-inc">+</div>
                      <div class="inum-btn inum-dec">-</div>
                    </div>
                    <div class="clearfix"></div>
                    <a class="dark-link update btn btn-sm pl-0 pr-0 disabled mt-3" href="javascript:void(0)">{{ 'cart.general.update_item' | t }}</a>
                  </td>

                  <!-- TOTAL -->
                  <td class="text-right pr-0">
                    <div class="mt-6 d-none d-lg-block"></div>
                    <div class="mt-3 d-none d-md-block d-md-none"></div>

                    {{ item.line_price | money }}
                  </td>
                </tr>
                {% endfor %}

                {% assign summary = 'inline'  %}
                {% include 'cart-summary' with summary  %}
              </tbody>
              
            </table>
            <div id="cartupsell"></div>
          </div>

          <div class="table-responsive d-lg-none corso-mobile">
            <table class="table mt-3">
              {% assign summary = 'full'  %}
              {% include 'cart-summary' with summary  %}
            </table>
          </div>
  <input id="cart_set_discount" type="hidden" name="discount" value="" />

        </form>

        {% else %}

        <div class="supports-cookies">
          <p>{{ 'cart.general.empty' | t }}</p>
          <p>{{ 'cart.general.continue_browsing_html' | t }}</p>
        </div>

        {% comment %}
        Cart no cookies state
        Browser cookies are required to use the cart. If cookies aren't enabled in the browser a message is displayed prompting the user to enable them.
        {% endcomment %}

        <div class="supports-no-cookies">
          <p>{{ 'cart.general.cookies_required' | t }}</p>
        </div>

        {% endif %}
      </div>
    </div>
  </div>
</div>
